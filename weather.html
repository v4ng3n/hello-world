<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather Forecast</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      margin: 0;
      padding: 0;
      background: #f9f9f9;
    }
    nav {
      background: #333;
      padding: 1rem;
    }
    nav a {
      color: white;
      margin-right: 1rem;
      text-decoration: none;
      font-weight: bold;
    }
    .container {
      padding: 2rem;
    }
    .forecast-day {
      background: white;
      margin-bottom: 1.5rem;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .forecast-day h3 {
      margin: 0 0 1rem 0;
    }
    .entry {
      display: flex;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    .entry img {
      width: 24px;
      height: 24px;
      margin-right: 0.5rem;
    }
    .details-toggle {
      color: #007bff;
      cursor: pointer;
      margin-top: 1rem;
      display: inline-block;
    }
    select {
      font-size: 1rem;
      padding: 0.5rem;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <nav>
    <a href="/">Home</a>
    <a href="/weather">Weather</a>
  </nav>
  <div class="container">
    <h1>Weather Forecast</h1>
    <label for="location-select">Select location:</label>
    <select id="location-select"></select>
    <div id="forecast"></div>
  </div>
  <script>
    const locationSelect = document.getElementById('location-select');
    const forecastContainer = document.getElementById('forecast');const locations = {
  Bergen: 'https://www.yr.no/api/v0/locations/1-308-bergen/forecast',
  Aalborg: 'https://www.yr.no/api/v0/locations/1-6081-aalborg/forecast',
  Hørmested: 'https://www.yr.no/api/v0/locations/1-2622207-hormested/forecast',
  Vojens: 'https://www.yr.no/api/v0/locations/1-2622442-vojens/forecast'
};

Object.keys(locations).forEach(loc => {
  const opt = document.createElement('option');
  opt.value = loc;
  opt.textContent = loc;
  locationSelect.appendChild(opt);
});

locationSelect.addEventListener('change', () => {
  loadForecast(locationSelect.value);
});

function formatTime(hour) {
  return String(hour).padStart(2, '0');
}

function loadForecast(loc) {
  fetch(locations[loc])
    .then(res => res.json())
    .then(data => {
      forecastContainer.innerHTML = '';
      const grouped = {};

      data.shortIntervals.forEach(entry => {
        const date = new Date(entry.start);
        const day = date.toISOString().split('T')[0];
        if (!grouped[day]) grouped[day] = [];
        grouped[day].push({
          hour: date.getHours(),
          temp: entry.temperature.value,
          wind: entry.wind.speed,
          rain: entry.precipitation.value,
          icon: entry.symbolCode
        });
      });

      Object.keys(grouped).slice(0, 3).forEach((day, idx) => {
        const entries = grouped[day];
        const dateObj = new Date(day);
        const weekday = dateObj.toLocaleDateString('en-GB', { weekday: 'long' });
        const label = idx === 0 ? 'Today' : idx === 1 ? 'Tomorrow' : 'Day after tomorrow';

        const card = document.createElement('div');
        card.className = 'forecast-day';

        const title = document.createElement('h3');
        title.textContent = `${weekday} – ${label} (${day.split('-').reverse().join('-')})`;
        card.appendChild(title);

        const chunks = [
          [0, 6], [6, 12], [12, 18], [18, 24]
        ];

        chunks.forEach(([start, end]) => {
          const chunkEntries = entries.filter(e => e.hour >= start && e.hour < end);
          if (chunkEntries.length) {
            const avg = arr => arr.reduce((a, b) => a + b) / arr.length;
            const icon = chunkEntries[Math.floor(chunkEntries.length / 2)].icon;
            const e = document.createElement('div');
            e.className = 'entry';
            e.innerHTML = `<img src="https://api.met.no/images/weathericons/svg/${icon}.svg" alt="" />
              <strong>${formatTime(start)}–${formatTime(end)}</strong> –
              ${Math.round(avg(chunkEntries.map(e => e.temp)))}°C,
              ${avg(chunkEntries.map(e => e.rain)).toFixed(1)} mm,
              ${Math.round(avg(chunkEntries.map(e => e.wind)))} m/s`;
            card.appendChild(e);
          }
        });

        const toggle = document.createElement('div');
        toggle.className = 'details-toggle';
        toggle.textContent = 'Detailed view';
        toggle.onclick = () => {
          if (toggle.textContent === 'Detailed view') {
            entries.forEach(e => {
              const row = document.createElement('div');
              row.className = 'entry';
              row.innerHTML = `<img src="https://api.met.no/images/weathericons/svg/${e.icon}.svg" alt="" />
                <strong>${formatTime(e.hour)}</strong> –
                ${e.temp}°C, ${e.rain} mm, ${e.wind} m/s`;
              card.appendChild(row);
            });
            toggle.textContent = 'Hide details';
          } else {
            loadForecast(loc);
          }
        };

        card.appendChild(toggle);
        forecastContainer.appendChild(card);
      });
    });
}

locationSelect.value = 'Bergen';
loadForecast('Bergen');

  </script>
</body>
</html>